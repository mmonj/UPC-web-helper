<html>
    <head>
        <title>UPC Logger</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">

        <link href="{{url_for('static', filename='styles/upc_log_form.css')}}" rel="stylesheet">

        <script type="text/javascript" src="{{url_for('static', filename='js/upc_log_form.js')}}"></script>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <link href="{{url_for('static', filename='styles/select2.min.css')}}" rel="stylesheet">
        <script type="text/javascript" src="{{url_for('static', filename='js/select2.min.js')}}"></script>

        <script>
            var CATEGORIZED_STORES = JSON.parse('{{categorized_stores | tojson | safe}}');
        </script>
    </head>

    <body onload="populate_store_options(); make_dropdown_select2();">
        <div class="all-container">
            <div id="m1-store-picker" style="display:block">
                <img style="max-height:500px; max-width:500px;" class="logo" id="crossmark-logo" src="{{url_for('static', filename='images/logo-1.png')}}"/>
                <br>
                <br>

                <label>UPC number scanned</label>
                <br>
                <input type="number" id="upc_value" value="{{upc}}"></input>
                <div id="upc-length-error" style="color:red;display:none">
                    <p>Error. UPC number must be 12 digits</p>
                </div>
                <br>
                <br>

                <label>Whose store?</label>
                <select id="person-dropdown">
                    {% for name, _ in categorized_stores.items() %}
                    <option value="{{name}}">{{name}}</option>
                    {% endfor %}
                </select>
                <br>
                <br>


                <label>Select a store</label>
                <br>
                <select required id="store-dropdown">
                </select>
                <br>

                <div id="store-error-message" style="color:red;display:none">
                    <p>Error. You must choose a store</p>
                </div>
                <br>
                <br>

                <div class="main-view-btn">
                    <button type="submit" class="btn-main-menu" onclick="handle_submit()">Submit</button>
                </div>
                <br>
                <br>
                <br>

                {{message}}
            </div>

    <!--------------------------------------------------------------------------------------------------------------------->

            <div id="m2-submission-successful" style="display:none">
                <!--<div class="modal-content">-->
                <!--<span class="close" onclick="toggle_modal();">&times;</span>-->
                <!--</div>-->

                <div id="scan-confirmation-block" class="scan-info" style="display:block">
                    <div class="scan-confirmation-header">
                        <h1>Submitted Successfully</h1>
                    </div>
                    <p id="m-upc-saved-message"></p>
                </div>

                <div class="main-view-btn">
                    <button type="submit" class="btn-main-menu" onclick="submit_upc_removal()">Remove this UPC</button>
                    <br>
                    <button type="submit" class="btn-main-menu" onclick="submit_reset_store_and_upc_remove()">Switch Store &amp; Remove this UPC</button>
                    <br>
                    <button type="submit" class="btn-main-menu" onclick="handle_manually_add_new_upc()">Manually Add/Remove New UPC</button>
                    <br>
                </div>

                    <label id="upc-removed-label" style="font-size:18px; color:red;display:none">UPC Removed. You may now go back to scanner</label>
                <br>
            </div>

            <div id="m2-currently-submitting" style="display:none">
                <div class="scan-info">
                    <h1>Submitting...</h1>
                    <br>
                </div>
            </div>

<!--------------------------------------------------------------------------------------------------------------------->

            <div id="m3-manual-buttons" style="display:none">
                <img style="max-height:500px; max-width:500px;" class="logo" id="crossmark-logo" src="{{url_for('static', filename='images/logo-1.png')}}"/>
                <br>
                <br>

                <label>Input a UPC Number</label>
                <br>
                <input type="number" id="input-add-upc-manual" placeholder="UPC number (12 digits)" style="font-size:16px">
                <br>
                <div class="main-view-btn">
                    <button type="submit" class="btn-manual" id="btn-new-upc-manual" onclick="submit_add_manual_upc()">Add UPC</button>
                    <button type="submit" class="btn-manual" id="btn-remove-upc-manual" onclick="submit_remove_manual_upc()">Remove UPC</button>
                </div>
                <br>

                <p><span id="upc-length-error-modal" style="display:none; transition:0.08s; font-size:18;">Error. UPC number must be 12 digits</span></p>
            </div>
        </div>

<!--------------------------------------------------------------------------------------------------------------------->

        <script>
            var PREVIOUS_STORE = null;
        </script>

        {% if is_continue_previous_store %}
        <script>
            PREVIOUS_STORE = "{{previous_store | safe}}";
            // const queryString = window.location.search;
            // const urlParams = new URLSearchParams(queryString);
            console.log(`Previous store is "${PREVIOUS_STORE}"`);
            submit_upc("{{upc}}", PREVIOUS_STORE);
        </script>
        {% else %}
        <script>
            console.log('is_continue_previous_store is False');
        </script>
        {% endif %}
    </body>
</html>
